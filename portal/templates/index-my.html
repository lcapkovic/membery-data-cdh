<!DOCTYPE html>
<html lang="sk">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>CityDownHill - index</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="copyright" content="Unionsoft" />
	<meta name="author" content="" />
	
	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/selectivizr/1.0.2/selectivizr-min.js"></script>
	<![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,600&subset=latin,latin-ext' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" type="text/css" href="/portal/css/standalone.css">
	<link rel="stylesheet" type="text/css" href="/portal/css/portal.css">
	<link rel="stylesheet" type="text/css" href="/portal/css/normalize.css">
	<link rel="stylesheet" type="text/css" href="/portal/css/font-awesome.min.css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>

<body>
	<header>
		<section>
			<div class="container">
				<div class="portal-social-panel">
					<ul>
						<li><a href="#"><i class="fa fa-instagram"></i></a></li>
						<li><a href="#"><i class="fa fa-dribbble"></i></a></li>
						<li><a href="#"><i class="fa fa-pinterest"></i></a></li>
						<li><a href="#"><i class="fa fa-google-plus"></i></a></li>
						<li><a href="#"><i class="fa fa-facebook"></i></a></li>
						<li><a href="#"><i class="fa fa-twitter"></i></a></li>
						<li><button class="sign-in" name="sign">SIGN IN</button></li>
					</ul>
				</div>
				<!-- <h1 class="logo"> -->
					<img class="logo" src="../client/img/logo.png" height="160" width="190" alt=""/>
				<!-- </h1> -->
				<div id="portal-menu-panel-container">
					{% block menu %}
						<ul id="portal-menu-panel">
							{%for k in menu %}
								<li class="portal-menu-entry">
									<a href="/{{k.aid}}">{{k.name}}</a>
								</li>
							{% endfor %}
						</ul>
					{% endblock menu %}
				</div>
			</div>
		</section>
	</header>

	<main id="portal-content-container">
		<section class="home">
			<div class="container">
				
			</div>
		</section>
		<section></section>
		<section></section>
		<section></section>
		<section></section>
		<section></section>
		<section></section>
		<section></section>
	</main>

	<footer>
		
	</footer>
</body>
<script>
	$(function() {
		$('.portal-club-logo').click(function () {
			window.open($(this).data('url'), '_blank');
		});
		$('#portal-menu-panel-container').removeClass('mobile-visible');
		var mainMenuHidden = true;
		$('.toogle-menu').click(function (e) {
			if (mainMenuHidden) {
				$('#portal-menu-panel-container').addClass('mobile-visible');
				mainMenuHidden = false;
			} else {
				$('#portal-menu-panel-container').removeClass('mobile-visible');
				mainMenuHidden = true;
			}
			e.stopPropagation();
			return false;
		});
		$('body').click(function () {
			$('#portal-menu-panel-container').removeClass('mobile-visible');
			mainMenuHidden = true;
		});
		$('.x-portal-widget-showcase-view').each(function() {
			$(this).bind('showcase-next', function() {
				var idx = $(this).data('showcase-current') || 0;

				$(this).find('article').eq(idx).fadeOut();

				if (idx == $(this).find('article').length - 1) {
					idx = 0;
				} else {
					++idx;
				}

				$(this).find('article').eq(idx).fadeIn();

				$(this).data('showcase-current', idx);

				var navigationEl = $(this).next();
				navigationEl.find('a.item').removeClass('active');
				navigationEl.find('a.item').eq(idx).addClass('active');

				setTimeout(function() {
					$('.x-portal-widget-showcase-view').triggerHandler('showcase-next');
				}, 4000);
			});

		}).triggerHandler('showcase-next');
		$('.x-portal-widget-showcase-navigation a.prev').click(function(e) {
			var showcaseEl = $(this).parent().prev();
			var navigationEl = $(this).parent();
			var idx = showcaseEl.data('showcase-current') || 0;
			showcaseEl.find('article').eq(idx).fadeOut();
			idx = idx - 1;
			if (idx < 0) {
				idx = $('.x-portal-widget-showcase-view article').size()-1;
			}
			showcaseEl.find('article').eq(idx).fadeIn();
			showcaseEl.data('showcase-current', idx);
			navigationEl.find('a.item').removeClass('active');
			navigationEl.find('a.item').eq(idx).addClass('active');
			e.stopPropagation();
			return false;
		});
		$('.x-portal-widget-showcase-navigation a.item').click(function(e) {
			var showcaseEl = $(this).parents('.x-portal-widget-showcase-navigation').prev();
			var navigationEl = $(this).parents('.x-portal-widget-showcase-navigation');
			var idx = showcaseEl.data('showcase-current') || 0;
			showcaseEl.find('article').eq(idx).fadeOut();
			idx = $(this).index();
			showcaseEl.find('article').eq(idx).fadeIn();
			showcaseEl.data('showcase-current', idx);
			navigationEl.find('a.item').removeClass('active');
			navigationEl.find('a.item').eq(idx).addClass('active');
			e.stopPropagation();
			return false;
		});
		$('.x-portal-widget-showcase-navigation a.next').click(function(e) {
			var showcaseEl = $(this).parent().prev();
			var navigationEl = $(this).parent();
			var idx = showcaseEl.data('showcase-current') || 0;
			showcaseEl.find('article').eq(idx).fadeOut();
			idx = (idx+1) % $('.x-portal-widget-showcase-view article').size();
			showcaseEl.data('showcase-current', idx);
			showcaseEl.find('article').eq(idx).fadeIn();
			navigationEl.find('a.item').removeClass('active');
			navigationEl.find('a.item').eq(idx).addClass('active');
			e.stopPropagation();
			return false;
		});

		$('.x-portal-widget-gallery').each(function(index) {

			$(this).find('.x-portal-widget-gallery-viewer-window-images').append(
				$(this).find('.x-portal-widget-gallery-thm > img').clone()
			);

			$(this).bind('gallery-next', function(e, idx) {
				
			});

			$(this).bind('gallery-show', function(e, idx) {
				$(this).find('.x-portal-widget-gallery-viewer').css('display', 'table-cell');
				$(this).data('gallery-current', idx);

				$(this).find('.x-portal-widget-gallery-viewer-window-images > img').eq(idx).fadeIn();
			});

			$(this).bind('gallery-next', function(e) {
				var idx = $(this).data('gallery-current');

				$(this).find('.x-portal-widget-gallery-viewer-window-images > img').eq(idx).fadeOut();

				if (idx == $(this).find('.x-portal-widget-gallery-viewer-window-images > img').length - 1) {
					idx = 0;
				} else {
					++idx;
				}

				$(this).find('.x-portal-widget-gallery-viewer-window-images > img').eq(idx).fadeIn();

				$(this).data('gallery-current', idx);
			});

			$(this).bind('gallery-prev', function(e) {
				var idx = $(this).data('gallery-current');

				$(this).find('.x-portal-widget-gallery-viewer-window-images > img').eq(idx).fadeOut();

				if (idx == 0) {
					idx = $(this).find('.x-portal-widget-gallery-viewer-window-images > img').length - 1;
				} else {
					--idx;
				}

				$(this).find('.x-portal-widget-gallery-viewer-window-images > img').eq(idx).fadeIn();

				$(this).data('gallery-current', idx);
			});

			$(this).bind('gallery-close', function(e, idx) {
				var idx = $(this).data('gallery-current');

				$(this).find('.x-portal-widget-gallery-viewer-window-images > img').eq(idx).hide();
				$(this).find('.x-portal-widget-gallery-viewer').fadeOut();
			});

			$(this).find('.x-portal-widget-gallery-close-btn').on('click', function() {
				$(this).closest('.x-portal-widget-gallery').triggerHandler('gallery-close');
			});

			$(this).find('.x-portal-widget-gallery-next-btn').on('click', function() {
				$(this).closest('.x-portal-widget-gallery').triggerHandler('gallery-next');
			});

			$(this).find('.x-portal-widget-gallery-prev-btn').on('click', function() {
				$(this).closest('.x-portal-widget-gallery').triggerHandler('gallery-prev');
			});

			$(this).find('.x-portal-widget-gallery-thm > img').each(function(idx){
				$(this).on('click', function(evt) {
					$(this).closest('.x-portal-widget-gallery').triggerHandler('gallery-show', [idx]);
				});
			});
		});

		$('.x-portal-competition-results').bind('competition-results-show', function() {
			var cid = $(this).find('.x-portal-competition-selector').val();
			var that = this;

			if (cid) {
				$.get('/competition/results/'+cid, function(data) {
					data.sort(function(a,b) { return b.points - a.points;});
					
					var table = $(that).find('table');

					table.empty();

					var counter = 0;
					for (var i in data) {

						var e = $('<tr><td style="text-align:right; padding-right: 5px;">'+ (++counter) +'</td><td style="font-weight: bold;">'+ data[i].name +'</td><td style="text-align: right;">'+data[i].matches+'z</td><td style="text-align: right;">'+data[i].points+'b</td><tr>');

						table.append(e);
					}
					updateMainContentHeight();
				});
			}
		});

		$('.x-portal-competition-results').find('.x-portal-competition-selector').on('change', function() {
			$(this).closest('.x-portal-competition-results').trigger('competition-results-show');
		});

		$('.x-portal-competition-matches').bind('competition-matches-show', function() {
			var cid = $(this).find('.x-portal-competition-selector').val();
			var that = this;

			if (cid) {
				$.get('/competition/matches/'+cid, function(data) {
					function formatDate(d) {
						return d.substr(6,2) + '.' +d.substr(4,2) + '.' + d.substr(0,4);
					}

					var tblContainer = $(that).find('.x-portal-widget-match-results-table');

					tblContainer.empty();

					var leftDiv = $('<div style="float: left;"></div>');
					var rightDiv = $('<div style="float: right;"></div>');
					tblContainer.append(leftDiv);
					tblContainer.append(rightDiv);

					var lastDate = null;
					var position = 0;
					for (var i in data) {
						var currDate = formatDate(data[i].matchDate);
						if (lastDate !== currDate) {
							var table = $('<table ></table>');
							if (position <= Math.ceil(data.length/2)) {
								leftDiv.append(table);
							} else {
								rightDiv.append(table);
							}
							table.append('<tr><td colspan="3" class="x-portal-results-date">'+currDate+'</td></tr>');
							lastDate = currDate;
							position++;
						}
						position++;

						var e = $('<tr><td class="x-portal-results-left-club">' + data[i].homeName + '</td><td class="x-portal-results-hyphen">'+(data[i].fullTimeScoreHome || '-')+ '&nbsp;-&nbsp;'+(data[i].fullTimeScoreAway || '-')+'</td><td class="x-portal-results-right-club">' + data[i].guestName + '</td></tr>');

						if (data[i].webNo) {
							e.on('click', null, {webNo: data[i].webNo}, function(evt) {
								window.open('http://szhonline.sk/onlinex.aspx?cislo=' + evt.data.webNo);
							});
							e.addClass('x-portal-results-selectable');
						}
						table.append(e);
					}
				});
			}
		});

		$('.x-portal-competition-matches').find('.x-portal-competition-selector').on('change', function() {
			$(this).closest('.x-portal-competition-matches').trigger('competition-matches-show');
		});
		//get competitions
		$.get('/competition/list', function(data) {
			data.sort(function(a,b) {if (a.name > b.name) {return 1;} else if (a.name == b.name) {return 0;} else {return -1;};})
			$('.x-portal-competition-selector').empty();
			for (var i in data) {
				$('.x-portal-competition-selector').append('<option value="'+data[i].id+'">'+ data[i].name +'</option>').trigger('change');;
			}
		});

		$('.portal-side-panel.partneri').each(function() {
			$(this).bind('showcase-next', function() {
				var idx = $(this).data('showcase-current') || 0;

				$(this).find('article').eq(idx).fadeOut();

				if (idx == $(this).find('article').length - 1) {
					idx = 0;
				} else {
					++idx;
				}

				$(this).find('article').eq(idx).fadeIn();

				$(this).data('showcase-current', idx);

				setTimeout(function() {
					$('.portal-side-panel.partneri').triggerHandler('showcase-next');
				}, 3000);
			});
		}).triggerHandler('showcase-next');
		updateMainContentHeight();
		$(window).resize(updateMainContentHeight);
	});

	function updateMainContentHeight() {
		if (parseInt($(window).width()) <= 400) {
			$('#portal-main-content').css('min-height', '0px');
		} else {
			$('#portal-main-content').css('min-height', parseInt($('#portal-side-content').height()) + 20);
		}
		
	}
	$('.x-portal-widget-category-prev-btn').click(function () {
		updateCategoryNextPrev(-1, 'category');
	});
	$('.x-portal-widget-category-next-btn').click(function () {
		updateCategoryNextPrev(1, 'category');
	});
	$('.x-portal-widget-overview-prev-btn').click(function () {
		updateCategoryNextPrev(-1, 'overview');
	});
	$('.x-portal-widget-overview-next-btn').click(function () {
		updateCategoryNextPrev(1, 'overview');
	});

	function updateCategoryNextPrev(step, type) {
		var pathParts = window.location.pathname.split('/');
		if (window.location.pathname && window.location.pathname.indexOf('article') > -1) {
			var currPage = 0;
			if (pathParts && pathParts.length > 3) {
				currPage = parseInt(pathParts[3]);
			}
			currPage = currPage + step;
			if (currPage < 0) {
				currPage = 0;
			}
			var nextpage = parseInt($('.x-portal-widget-' + type + '-navigation').data('nextpage'));
			if (currPage >= nextpage) {
				currPage = nextpage;
			}
			pathParts[3] = currPage;
			window.location.pathname = pathParts.join('/');
		} else {
			var currPage = 0;
			if (pathParts && pathParts.length > 1 && pathParts[1]) {
				currPage = parseInt(pathParts[1]);
			}
			currPage = currPage + step;
			if (currPage < 0) {
				currPage = 0;
			}
			var nextpage = parseInt($('.x-portal-widget-' + type + '-navigation').data('nextpage'));
			if (currPage >= nextpage) {
				currPage = nextpage;
			}
			pathParts[1] = currPage;
			window.location.pathname = pathParts.join('/');
		}
	}
</script>
</html>
